(function(n){function r(){n("#dtpFromDate").datetimepicker({locale:"vi",format:"DD/MM/YYYY",defaultDate:moment().add(-7,"days")});n("#dtpToDate").datetimepicker({locale:"vi",format:"DD/MM/YYYY",defaultDate:moment(),useCurrent:!1});n("#dtpFromDate").on("dp.change",function(t){n("#dtpToDate").data("DateTimePicker").minDate(t.date)});n("#dtpToDate").on("dp.change",function(t){n("#dtpFromDate").data("DateTimePicker").maxDate(t.date)})}function t(){if(n("#chkToday").is(":checked")===!1){if(n("#dtpFromDate").val()===""||n("#dtpToDate").val()==="")return notifyDanger("Vui lòng nhập từ ngày và đến ngày"),!1;var i=moment(n("#dtpFromDate").val(),"DD/MM/YYYY"),r=moment(n("#dtpToDate").val(),"DD/MM/YYYY"),t=moment.duration(r.diff(i));if(t.asDays()<0)return notifyDanger("Từ ngày không được nhỏ hơn đến ngày"),!1;if(t.asDays()>60)return notifyDanger("Từ ngày và đến ngày không cách nhau 60 ngày"),!1}return!0}function i(i){var r=n(".mvc-grid-pager-rows").val(),u,f;i||(i=1);r&&parseInt(r)!==0||(r=10);u=t();u===!0&&(f={areaCode:n("#cboBranchs").val(),branchCode:n("#cboAreas").val(),userId:n("#cboUsers").val(),filter:n("#cboFilter").val(),filterValue:n.trim(n("#txtFilterValue").val()),transType:n("#cboType").val(),status:n("#cboStatus").val(),fromDate:n("#dtpFromDate").val(),toDate:n("#dtpToDate").val(),productCode:n("#cboProduct").val(),pageNo:i,pageSize:r,isPaging:1},n.ajax({url:"/Report/RptGeneralReg",type:"get",dataType:"html",data:f,success:function(t){n("#data-grid").html(t)}}))}function u(){var r=t(),i;r===!0&&(i={areaCode:n("#cboBranchs").val(),branchCode:n("#cboAreas").val(),userId:n("#cboUsers").val(),filter:n("#cboFilter").val(),filterValue:n.trim(n("#txtFilterValue").val()),transType:n("#cboType").val(),status:n("#cboStatus").val(),fromDate:n("#dtpFromDate").val(),toDate:n("#dtpToDate").val(),pageNo:0,pageSize:0,isPaging:0},n.ajax({type:"POST",url:"/Report/ExportRptDiscount",data:i,xhrFields:{responseType:"blob"},success:function(n,t,i){var f="",o=i.getResponseHeader("Content-Disposition"),h,e,s,u,r;o&&o.indexOf("attachment")!==-1&&(h=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,e=h.exec(o),e!==null&&e[1]&&(f=e[1].replace(/['"]/g,"")));typeof window.navigator.msSaveBlob!="undefined"?window.navigator.msSaveBlob(n,f):(s=window.URL||window.webkitURL,u=s.createObjectURL(n),f?(r=document.createElement("a"),typeof r.download=="undefined"?window.location.href=u:(r.href=u,r.download=f,document.body.appendChild(r),r.click())):window.location.href=u,setTimeout(function(){s.revokeObjectURL(u)},100))}}))}n(document).ready(function(){r();bindSearchInfoPartial();n(document).on("click","#btn-search",function(n){n.preventDefault();i()});n(document).on("click","#btn-report-discount",function(n){n.preventDefault();u()});n(document).on("click",".grid-pager button",function(t){t.preventDefault();var r=n(this).attr("data-page");i(r)});n(document).on("click","#btn-print",function(){var t=n(this).data("id"),r=n(this).data("code"),i=n(this).data("type");i==="I"?printInvoicePayInto(t):printInvoiceWithdraw(t)})})})(jQuery);