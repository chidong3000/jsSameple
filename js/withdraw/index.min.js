function calculator(n,t,i,r,u,f,e){if(ClearData(),e==="0"){notifyDanger("Tài khoản ví không tồn tại");return}var o=parseInt(t);if(o<=0){notifyDanger("Không đủ số dư để thực hiện giao dịch");return}$("#txtWithdrawAmt").focus();$("#txtAllowAmount").val(formatNumber(t));$("#txtFeeAmount").val(0);$("#txtAmountAfter").val();$("#txtRefNo").val(i);$("#txtPeCode").val(n);$("#txtProduct").val(r);$("#txtProductName").val(u);$("#txtScheduleId").val(f);$("#pnlDetail").removeAttr("hidden");$("#btnMaster").removeAttr("hidden");$(location).attr("href","#pnlDetail")}function cal(n){var t,i,r;if(n.value.length>12||!$.isNumeric(n.value.replace(/[^0-9-]+/g,""))){notifyDanger("Số bạn nhập không hợp lệ");$("#txtWithdrawAmt").val("");$("#txtAmountAfter").val("");return}if(t=$("#txtAllowAmount").val().replace(/[^0-9-]+/g,""),(t===null||t==="")&&(t=0),parseInt(n.value)<1e4){notifyDanger("Vui lòng nhập số tiền lớn hơn 10.000 vnđ");$("#txtWithdrawAmt").val("");$("#txtAmountAfter").val("");return}if(i=$("#txtFeeAmount").val(),i||(i=0),r=parseInt(t)-parseInt(n.value.replace(/[^0-9-]+/g,""))-i,r<0){notifyDanger("Bạn không thể rút số tiền vượt quá hạn số dư");$("#txtWithdrawAmt").val("");$("#txtAmountAfter").val("");$("#txtAmountString").text("");return}$("#txtAmountAfter").val(formatNumber(r));ReadMoney(n.value)}function bindGrid(n){var t=$(".mvc-grid-pager-rows").val(),i;n||(n=1);t||(t=10);$("#lblNotExist").text("");$("#lblEdongNotExist").text("");i={pageNo:n,pageSize:t,filter:$("#cboFilter").val(),para:$("#txt-filter").val()};$.ajax({url:"/Withdraw/GetCustomerInfo",type:"post",dataType:"html",data:i,success:function(n){var i,t;n.trim().length>0?($("#divlblNotExist").attr("hidden",!0),$("#divlblEdongNotExist").attr("@ViewBag.Hidden",!1),i=$(n).find("div#pnlCustomer").get(0),$("#cusInfo").html($(i.innerHTML)),t=$(n),t.find("div#pnlCustomer").remove(),$("#data-grid").html(t)):($("#divlblNotExist").removeAttr("hidden"),$("#lblNotExist").text("Không tồn tại hợp đồng được phép rút tiền"),$("#cusInfo").html(""),$("#data-grid").empty(),$("#btnMaster").attr("hidden",!0))}})}function ReadMoney(n){var t=0;try{t=$("#txtWithdrawAmt").val().replace(/[^0-9-]+/g,"")}catch(i){t=0}$.ajax({url:"/Withdraw/ReadMoney",type:"post",dataType:"json",data:{amt:n.replace(/[^0-9-]+/g,"")},success:function(n){var i=n;$("#txtAmountString").text(i);$("#txtWithdrawAmt").val(formatNumber(t))}})}function printWithdraw(n){$.ajax({dataType:"html",type:"post",url:"/Withdraw/PrintWithdraw",data:{id:n},success:function(n){$("#data-withdraw-info").html("").html(n);$("#data-withdraw-info").print({globalStyles:!1,mediaPrint:!1,stylesheet:"/css/print-invoice.css",iframe:!1,noPrintSelector:".avoid-this",prepend:"",append:"",deferred:$.Deferred().done(function(){location.reload()})})}})}function validateForm(){if(parseInt($("#txtWithdrawAmt").val().replace(/[^0-9-]+/g,""))<=0){notifyDanger("Bạn vui lòng nhập số tiền rút");$("#txtWithdrawAmt").focus();return}return!0}function convertToNum(n){return parseInt(n.replace(/[^0-9-]+/g,""))}function ClearData(){$("#txtWithdrawAmt").val("");$("#txtAllowAmount").val("");$("#txtFeeAmount").val(0);$("#txtAmountAfter").val("");$("#txtRefNo").val("");$("#txtPeCode").val("");$("#txtProduct").val("");$("#txtProductName").val("");$("#txtAmountString").text("");$("#txt-otp").val("");$("#txtScheduleId").val("")}var uiLibrary="bootstrap4",$postData=$("#post-data"),dialog1,grid;$(document).ready(function(){$("#btn-quit").on("click",function(){window.location.href="Home"});$("#btn-search-cust").on("click",function(n){ClearData();var i=$("#cboFilter").val(),t=$("#txt-filter").val();if(t===null||t===""){notifyDanger("Vui lòng điều kiện cần tìm");$("#txt-filter").focus();return}if(i==="CMND"&&!$.isNumeric(t)){notifyDanger("Vui lòng nhập số cho CMND");return}$("#pnlDetail").attr("hidden",!0);$("#btnMaster").attr("hidden",!0);n.preventDefault();bindGrid()});$(document).on("click","#btn-otp",function(){var u=$.trim($("#txtFullName").val()),n=$.trim($("#txtPhone").val()),i=$.trim($("#txtPeCode").val()),r=$.trim($("#txtRefNo").val()),t=$.trim($("#txtWithdrawAmt").val());if(isEmpty(n)){notifyDanger("Vui lòng nhập số điện thoại");return}if(isEmpty(t)||convertToNum(t)<=0){$("#txtWithdrawAmt").focus();notifyDanger("Vui lòng nhập số tiền rút");return}if(validatePhone(n)===!1){notifyDanger("Vui lòng nhập số điện thoại hợp lệ");return}$.ajax({url:"/otp/RequestOtp",type:"get",dataType:"json",data:{custPeCode:i,phone:n,contractNo:r},success:function(n){n.success===!1?notifyDanger(n.message):notifyInfo("Đã gửi OTP")},error:function(n){console.log(n.responseText)}})});$(document).on("click","#btn-save",function(){var t=$.trim($("#txtPhone").val()),i=$.trim($("#txtRefNo").val()),u=$.trim($("#txtAmountString").text()),n=$.trim($("#txt-otp").val()),r=$.trim($("#txtWithdrawAmt").val()).replace(/[^0-9-]+/g,""),f=$.trim($("#txtAmountAfter").val()).replace(/[^0-9-]+/g,""),e=$.trim($("#txtAllowAmount").val()).replace(/[^0-9-]+/g,""),o=$.trim($("#txtPeCode").val()),s=$.trim($("#txtProduct").val()),h=$.trim($("#txtFullName").val()),c=$.trim($("#txtPhone").val()),l=$.trim($("#txtCmnd").val()),a=$.trim($("#cbo-cst-identity-type").val()),v=$.trim($("#txtScheduleId").val());if(isEmpty(n)){notifyDanger("Vui lòng nhập OTP");$("#txt-otp").focus();return}if(isEmpty(r)){notifyDanger("Vui lòng nhập số tiền rút");$("#txtWithdrawAmt").focus();return}if(isEmpty(n.length>8)){notifyDanger("Vui lòng nhập OTP tối đa 8 chử số");$("#txt-otp").focus();return}$.ajax({url:"/otp/AuthOtp",type:"get",dataType:"json",data:{otpCode:n,phone:t,contractNo:i},success:function(y){if(y.success===!1){notifyDanger(y.message);return}var p={phone:t,refCode:i,peCode:o,productCode:s,totalAmtDue:r,allowAmt:e,feeAmt:"0",availableAmt:f,totalAmtDueText:u,verifyCode:n,payementMethod:"COD",custPhone:c,custName:h,custIdentify:l,custIdentifyType:a,scheduleId:v};$.ajax({url:"/Withdraw/SaveWithdraw",type:"post",dataType:"json",data:p,success:function(n){n.success===!0?($("#txtResponeData").val(n.data),$("#btn-save").prop("disabled",!0),$("#btn-print").prop("disabled",!1),$.alert({title:"Thông báo thành công",content:"Rút tiền thành công",type:"green",typeAnimated:!0,buttons:{ok:{text:"Đồng ý",btnClass:"btn-green",keys:["enter","shift"],action:function(){}}}})):notifyDanger(n.message)}})},error:function(n){notifyDanger("Lỗi OTP:"+n.responseText);console.log(n.responseText)}})});$(document).on("click","#btn-print",function(){$("#txtResponeData").val()!==""&&printWithdraw($("#txtResponeData").val())})});