/*!
 * Mvc.Grid 5.0.1
 * https://github.com/NonFactors/MVC6.Grid
 *
 * Copyright Â© NonFactors
 *
 * Licensed under the terms of the MIT License
 * http://www.opensource.org/licenses/mit-license.php
 */
function MvcGridExtends(n,t){function i(){this.constructor=n}Object.setPrototypeOf(n,t);n.prototype=(i.prototype=t.prototype,new i)}var MvcGrid=function(){function n(n,t){var i=this,u,r;if(t=t||{},n=i.findGrid(n),n.dataset.id)return i.instances[parseInt(n.dataset.id)].set(t);i.columns=[];i.element=n;i.loadingDelay=300;i.requestType="get";i.name=n.dataset.name;i.popup=new MvcGridPopup(i);i.prefix=i.name?i.name+"-":"";i.sourceUrl=i.element.dataset.sourceUrl;i.element.dataset.id=t.id||i.instances.length;i.filterMode=(n.dataset.filterMode||"excel").toLowerCase();i.filters={"enum":MvcGridEnumFilter,date:MvcGridDateFilter,guid:MvcGridGuidFilter,text:MvcGridTextFilter,number:MvcGridNumberFilter,boolean:MvcGridBooleanFilter};u=n.querySelectorAll(".mvc-grid-row-filters th");[].forEach.call(n.querySelectorAll(".mvc-grid-headers th"),function(n,t){i.columns.push(new MvcGridColumn(i,n,u[t]))});r=n.querySelector(".mvc-grid-pager");r&&(i.pager=new MvcGridPager(i,r));t.id?i.instances[parseInt(t.id)]=i:i.instances.push(i);i.set(t);i.cleanUp();i.bind();i.sourceUrl&&!n.children.length&&i.reload()}return n.prototype={instances:[],lang:{text:{contains:"Contains",equals:"Equals","not-equals":"Not equals","starts-with":"Starts with","ends-with":"Ends with"},number:{equals:"Equals","not-equals":"Not equals","less-than":"Less than","greater-than":"Greater than","less-than-or-equal":"Less than or equal","greater-than-or-equal":"Greater than or equal"},date:{equals:"Equals","not-equals":"Not equals","earlier-than":"Earlier than","later-than":"Later than","earlier-than-or-equal":"Earlier than or equal","later-than-or-equal":"Later than or equal"},"enum":{equals:"Equals","not-equals":"Not equals"},guid:{equals:"Equals","not-equals":"Not equals"},boolean:{equals:"Equals","not-equals":"Not equals"},filter:{apply:"&#10003;",remove:"&#10008;"},operator:{select:"",and:"and",or:"or"}},findGrid:function(n){var t=n;if(!t)throw new Error("Grid element was not specified.");while(t&&!t.classList.contains("mvc-grid"))t=t.parentElement;if(!t)throw new Error("Grid can only be created from within mvc-grid structure.");return t},set:function(n){var t=this,u=n.filters||{},r,i;for(r in u)t.filters[r]=u[r];return t.requestType=n.requestType||t.requestType,t.sourceUrl=n.sourceUrl===undefined?t.sourceUrl:n.sourceUrl,t.loadingDelay=n.loadingDelay===undefined?t.loadingDelay:n.loadingDelay,t.sourceUrl?(i=t.sourceUrl.split("?",2),t.sourceUrl=i[0],n.query!==undefined?t.query=new MvcGridQuery(n.query):(i[1]||!t.query)&&(t.query=new MvcGridQuery(i[1]))):t.query=n.query===undefined?new MvcGridQuery(window.location.search):new MvcGridQuery(n.query),t.columns.forEach(function(n){n.updateFilter();n.filter&&t.filters[n.filter.name]&&(n.filter.instance=new t.filters[n.filter.name](n),n.filter.instance.init())}),this},reload:function(){var t=this;t.dispatchEvent("reloadstart",{grid:t});t.sourceUrl?t.startLoading(function(i){var r=t.element.parentElement,f=[].indexOf.call(r.children,t.element),u;if(t.element.outerHTML=i,!r.children[f].classList.contains("mvc-grid"))throw new Error("Grid partial should only include grid declaration.");u=new n(r.children[f],{loadingDelay:t.loadingDelay,requestType:t.requestType,query:t.query.toString(),id:t.element.dataset.id,sourceUrl:t.sourceUrl,filters:t.filters});u.dispatchEvent("reloadend",{grid:u})},function(n){t.dispatchEvent("reloadfail",{grid:t,result:n})}):window.location.href=window.location.origin+window.location.pathname+t.query},applyFilters:function(n){var t=this,r=t.query,i=t.prefix,u=t.query.get(i+"sort"),f=t.query.get(i+"order");t.clearQuery();t.columns.filter(function(t){return t.filter&&(t==n||t.filter.first.values[0])}).forEach(function(n){var u=n.filter,f;for(r.append(i+n.name+"-"+u.first.method,u.first.values[0]),f=1;u.type=="multi"&&f<u.first.values.length;f++)r.append(i+n.name+"-"+u.first.method,u.first.values[f]);t.filterMode=="excel"&&u.type=="double"&&(r.append(i+n.name+"-op",u.operator),r.append(i+n.name+"-"+u.second.method,u.second.values[0]))});u&&r.append(i+"sort",u);f&&r.append(i+"order",f);t.pager&&t.pager.showPageSizes&&r.append(i+"rows",t.pager.rowsPerPage.value);t.reload()},clearQuery:function(){var n=this.query,t=this.prefix;this.columns.forEach(function(i){n.deleteAllStartingWith(t+i.name+"-")});n.delete(t+"order");n.delete(t+"sort");n.delete(t+"page");n.delete(t+"rows")},startLoading:function(n,t){var i=this,u=(i.query.toString()?i.query+"&":"?")+"_="+Date.now(),r;i.stopLoading();i.loadingDelay==null||i.element.querySelector(".mvc-grid-loader")||(r=document.createElement("div"),r.appendChild(document.createElement("div")),r.appendChild(document.createElement("div")),r.appendChild(document.createElement("div")),i.loader=document.createElement("div"),i.loader.className="mvc-grid-loader",i.loader.appendChild(r),i.loading=setTimeout(function(){i.loader.classList.add("mvc-grid-loading")},i.loadingDelay),i.element.appendChild(i.loader));i.request=new XMLHttpRequest;i.request.open(i.requestType,i.sourceUrl+u,!0);i.request.setRequestHeader("X-Requested-With","XMLHttpRequest");i.request.onload=function(){200<=i.request.status&&i.request.status<400&&n(i.request.responseText);i.request.status===401?location.reload():t&&t(i.request.responseText)};i.request.onerror=t;i.request.send()},stopLoading:function(){var n=this;n.request&&n.request.readyState!=4&&n.request.abort();clearTimeout(n.loading);n.loader&&n.loader.parentElement.removeChild(n.loader)},dispatchEvent:function(n,t){var i;typeof Event=="function"?i=new CustomEvent(n,{detail:t,bubbles:!0}):(i=document.createEvent("Event"),i.initEvent(n,!0,!1),i.detail=t);this.element.dispatchEvent(i)},bind:function(){var n=this;[].forEach.call(n.element.querySelectorAll("tbody tr"),function(t){t.classList.contains("mvc-grid-empty-row")||t.addEventListener("click",function(i){var u={},r,f={grid:n,data:u,originalEvent:i};n.columns.forEach(function(n,i){u[n.name]=t.cells[i].innerText});typeof Event=="function"?r=new CustomEvent("rowclick",{detail:f,bubbles:!0}):(r=document.createEvent("Event"),r.initEvent("rowclick",!0,!1),r.detail=f);this.dispatchEvent(r)})})},cleanUp:function(){delete this.element.dataset.sourceUrl;delete this.element.dataset.filterMode}},n}(),MvcGridColumn=function(){function n(n,t,i){var r=this,u=t.dataset,f;r.grid=n;r.header=t;r.name=u.name;r.rowFilter=i;r.isHidden=t.classList.contains("mvc-grid-hidden");u.filter=="True"&&u.filterName&&(f=t.querySelector(".mvc-grid-options"),n.filterMode=="row"&&(f=i.querySelector("select")),f&&f.classList.contains("mvc-grid-options")&&f.parentElement.removeChild(f),r.filter={button:(r.rowFilter||r.header).querySelector(".mvc-grid-filter"),inlineInput:i?i.querySelector(".mvc-grid-value"):null,hasOptions:f&&f.children.length>0,type:u.filterType.toLowerCase()||"single",defaultMethod:u.filterDefaultMethod,isApplied:u.filterApplied=="True",name:u.filterName,options:f},r.bindFilter());u.sort=="True"&&(r.sort={button:r.header.querySelector(".mvc-grid-sort"),order:u.sortOrder.toLowerCase(),first:u.sortFirst},r.bindSort());r.cleanUp()}return n.prototype={cancelFilter:function(){var n=this,t=n.grid;n.filter.isApplied?(t.query.delete(t.prefix+"page"),t.query.delete(t.prefix+"rows"),t.query.deleteAllStartingWith(t.prefix+n.name+"-"),t.reload()):(n.filter.first.values=[],n.filter.second.values=[],n.grid.filterMode!="excel"&&(n.filter.inlineInput.value=""))},applySort:function(){var t=this,n=t.grid,i;n.query.delete(n.prefix+"sort");n.query.delete(n.prefix+"order");i=t.sort.order=="asc"?"desc":"asc";!t.sort.order&&t.sort.first&&(i=t.sort.first);n.query.append(n.prefix+"sort",t.name);n.query.append(n.prefix+"order",i);n.reload()},updateFilter:function(){var t=this,n=t.filter,u=t.grid.query,i=t.grid.prefix+t.name+"-";if(n){var f=u.entries().filter(function(n){return n.split("=",1)!=i+"op"&&n.indexOf(i)==0}),e=f.map(function(n){return decodeURIComponent(n.split("=",1)[0].substring(i.length)||"")}),r=f.map(function(n){return decodeURIComponent(n.split("=",2)[1]||"")});n.first={method:e[0]||"",values:n.type=="multi"?r:r.slice(0,1)};n.operator=n.type=="double"&&u.get(i+"op")||"";n.second={method:n.type=="double"?e[1]||"":"",values:n.type=="double"?r.slice(1,2):[]}}},bindFilter:function(){var t=this,n=t.filter;n.button.addEventListener("click",function(){n.instance.show()});n.hasOptions?t.grid.filterMode=="row"&&n.type!="multi"?t.filter.inlineInput.addEventListener("change",function(){n.first.values=[this.value];n.instance.apply()}):(t.grid.filterMode=="header"||t.grid.filterMode=="row")&&t.filter.inlineInput.addEventListener("click",function(){this.selectionStart==this.selectionEnd&&n.instance.show()}):t.grid.filterMode!="excel"&&(t.filter.inlineInput.addEventListener("input",function(){n.first.values=[this.value];n.instance.validate(this)}),t.filter.inlineInput.addEventListener("keyup",function(t){t.which==13&&n.instance.isValid(this.value)&&n.instance.apply()}))},bindSort:function(){var n=this;n.filter&&n.grid.filterMode=="header"||n.header.addEventListener("click",function(t){/mvc-grid-(sort|filter)/.test(t.target.className)||n.applySort()});n.sort.button.addEventListener("click",function(){n.applySort()})},cleanUp:function(){var n=this.header.dataset;delete n.filterDefaultMethod;delete n.filterApplied;delete n.filterType;delete n.filterName;delete n.filter;delete n.sortOrder;delete n.sortFirst;delete n.sort;delete n.name}},n}(),MvcGridPager=function(){function n(n,t){var i=this;i.grid=n;i.element=t;i.pages=t.querySelectorAll("[data-page]");i.showPageSizes=t.dataset.showPageSizes=="True";i.rowsPerPage=t.querySelector(".mvc-grid-pager-rows");i.currentPage=i.pages.length?parseInt(t.querySelector(".active").dataset.page):1;i.cleanUp();i.bind()}return n.prototype={apply:function(n){var t=this.grid;t.query.delete(t.prefix+"page");t.query.delete(t.prefix+"rows");t.query.append(t.prefix+"page",n);this.showPageSizes&&t.query.append(t.prefix+"rows",this.rowsPerPage.value);t.reload()},bind:function(){var n=this;[].forEach.call(n.pages,function(t){t.addEventListener("click",function(){n.apply(this.dataset.page)})});n.rowsPerPage.addEventListener("change",function(){n.apply(n.currentPage)})},cleanUp:function(){delete this.element.dataset.showPageSizes}},n}(),MvcGridPopup=function(){function n(n){this.element.className="mvc-grid-popup";this.grid=n;this.bind()}return n.prototype={lastActiveElement:null,element:document.createElement("div"),render:function(n){this.element.className=("mvc-grid-popup "+n.cssClasses).trim();this.element.innerHTML=n.render();this.updateValues(n.column)},updatePosition:function(n){var t=this,i=n.filter.button,f=t.element.clientWidth,e=i.getBoundingClientRect(),o=t.element.querySelector(".popup-arrow"),h=window.pageYOffset+e.top+i.offsetHeight*.6+o.offsetHeight,r=window.pageXOffset+e.left-8,s=i.offsetWidth/2,u;r+f+8>window.pageXOffset+document.documentElement.clientWidth&&(u=f-i.offsetWidth-16,s+=u,r-=u);t.element.style.left=r+"px";t.element.style.top=h+"px";o.style.left=s+"px"},updateValues:function(n){var t=this,i=n.filter;t.setValues(".mvc-grid-operator",[i.operator]);t.setValues('.mvc-grid-value[data-filter="first"]',i.first.values);t.setValues('.mvc-grid-value[data-filter="second"]',i.second.values);t.setValues('.mvc-grid-method[data-filter="first"]',[i.first.method]);t.setValues('.mvc-grid-method[data-filter="second"]',[i.second.method])},setValues:function(n,t){var i=this.element.querySelector(n);i&&(i.tagName=="SELECT"&&i.multiple?[].forEach.call(i.options,function(n){n.selected=t.indexOf(n.value)>=0}):i.value=t[0]||"")},show:function(t){var i=this;n.prototype.lastActiveElement=document.activeElement;i.element.parentElement||document.body.appendChild(i.element);i.updatePosition(t);i.element.querySelector(".mvc-grid-value").focus()},hide:function(t){for(var i=t&&t.target,r=n.prototype;i&&!/mvc-grid-(popup|filter)/.test(i.className);)i=i.parentElement;i&&t.which!=27||!r.element.parentNode||t&&t.target==window||(document.body.removeChild(r.element),r.lastActiveElement&&(r.lastActiveElement.focus(),r.lastActiveElement=null))},bind:function(){var n=this;window.addEventListener("resize",n.hide);window.addEventListener("keydown",n.hide);window.addEventListener("mousedown",n.hide);window.addEventListener("touchstart",n.hide)}},n}(),MvcGridQuery=function(){function n(n){this.parameters=(n||"").replace("?","").split("&").filter(Boolean)}return n.prototype={entries:function(){return this.parameters.slice()},get:function(n){return this.parameters.filter(function(t){return t==n||t.indexOf(n+"=")==0}).map(function(n){return decodeURIComponent(n.split("=",2)[1])})[0]},set:function(n,t){this.delete(n);this.append(n,t)},append:function(n,t){this.parameters.push(encodeURIComponent(n)+"="+encodeURIComponent(t||""))},"delete":function(n){n=encodeURIComponent(n);this.parameters=this.parameters.filter(function(t){return t.indexOf(n+"=")})},deleteAllStartingWith:function(n){n=encodeURIComponent(n);this.parameters=this.parameters.filter(function(t){return t.split("=",1)[0].indexOf(n)})},toString:function(){return this.parameters.length?"?"+this.parameters.join("&"):""}},n}(),MvcGridFilter=function(){function n(n){var t=this;t.methods=[];t.column=n;t.cssClasses="";t.popup=n.grid.popup;t.type=n.filter.type;t.mode=n.grid.filterMode}return n.prototype={init:function(){var t=this,n=t.column;n.filter.hasOptions||t.mode=="excel"||t.validate(n.filter.inlineInput);n.filter.first.method||(n.filter.first.method=n.filter.defaultMethod);n.filter.second.method||(n.filter.second.method=n.filter.defaultMethod);t.methods.indexOf(n.filter.first.method)<0&&(n.filter.first.method=t.methods[0]);t.methods.indexOf(n.filter.second.method)<0&&(n.filter.second.method=t.methods[0])},show:function(){var n=this;n.popup.render(n);n.bindOperator();n.bindMethods();n.bindValues();n.bindActions();n.popup.show(n.column)},render:function(){var n=this;return n.lang=n.column.grid.lang,'<div class="popup-arrow"><\/div><div class="popup-content"><div class="popup-filter">'+n.renderFilter("first")+"<\/div>"+(n.mode=="excel"&&n.type=="double"?n.renderOperator()+'<div class="popup-filter">'+n.renderFilter("second")+"<\/div>":"")+n.renderActions()+"<\/div>"},renderFilter:function(n){var t=this,i=t.column.filter.hasOptions,r=t.lang[t.column.filter.name]||{},u=t.type=="multi"?" multiple":"";return'<div class="popup-group"><select class="mvc-grid-method" data-filter="'+n+'">'+t.methods.map(function(n){return'<option value="'+n+'">'+(r[n]||"")+"<\/option>"}).join("")+'<\/select><\/div><div class="popup-group">'+(i?'<select class="mvc-grid-value" data-filter="'+n+'"'+u+">"+t.column.filter.options.innerHTML+"<\/select>":'<input class="mvc-grid-value" data-filter="'+n+'">')+"<\/div>"},renderOperator:function(){return'<div class="popup-operator"><div class="popup-group"><select class="mvc-grid-operator"><option value="">'+this.lang.operator.select+'<\/option><option value="and">'+this.lang.operator.and+'<\/option><option value="or">'+this.lang.operator.or+"<\/option><\/select><\/div><\/div>"},renderActions:function(){return'<div class="popup-actions"><button type="button" class="mvc-grid-apply" type="button">'+this.lang.filter.apply+'<\/button><button type="button" class="mvc-grid-cancel" type="button">'+this.lang.filter.remove+"<\/button><\/div>"},apply:function(){MvcGridPopup.prototype.lastActiveElement=null;this.column.grid.applyFilters(this.column);this.popup.hide()},cancel:function(){this.column.filter.isApplied&&(MvcGridPopup.prototype.lastActiveElement=null);this.column.cancelFilter();this.popup.hide()},isValid:function(){return!0},validate:function(n){this.isValid(n.value)?n.classList.remove("invalid"):n.classList.add("invalid")},bindOperator:function(){var t=this.column.filter,n=this.popup.element.querySelector(".mvc-grid-operator");n&&n.addEventListener("change",function(){t.operator=this.value})},bindMethods:function(){var n=this.column.filter;[].forEach.call(this.popup.element.querySelectorAll(".mvc-grid-method"),function(t){t.addEventListener("change",function(){n[this.dataset.filter].method=this.value})})},bindValues:function(){var n=this;[].forEach.call(n.popup.element.querySelectorAll(".mvc-grid-value"),function(t){t.tagName=="SELECT"?t.addEventListener("change",function(){if(n.column.filter[t.dataset.filter].values=[].filter.call(t.options,function(n){return n.selected}).map(function(n){return n.value}),n.mode!="excel"){var i=n.column.filter.inlineInput;i.value=n.mode=="header"||n.mode=="row"&&n.type=="multi"?[].filter.call(t.options,function(n){return n.selected}).map(function(n){return n.text}).join(", "):t.value;n.validate(i)}n.validate(t)}):(t.addEventListener("input",function(){if(n.column.filter[t.dataset.filter].values=[t.value],n.mode!="excel"){var i=n.column.filter.inlineInput;i.value=n.column.filter[t.dataset.filter].values.join(", ");n.validate(i)}n.validate(t)}),t.addEventListener("keyup",function(t){t.which==13&&n.isValid(this.value)&&n.apply()}));n.validate(t)})},bindActions:function(){var n=this.popup.element;n.querySelector(".mvc-grid-apply").addEventListener("click",this.apply.bind(this));n.querySelector(".mvc-grid-cancel").addEventListener("click",this.cancel.bind(this))}},n}(),MvcGridTextFilter=function(n){function t(t){n.call(this,t);this.methods=["contains","equals","not-equals","starts-with","ends-with"]}return MvcGridExtends(t,n),t}(MvcGridFilter),MvcGridNumberFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals","less-than","greater-than","less-than-or-equal","greater-than-or-equal"]}return MvcGridExtends(t,n),t.prototype.isValid=function(n){return!n||/^(?=.*\d+.*)[-+]?\d*[.,]?\d*$/.test(n)},t}(MvcGridFilter),MvcGridDateFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals","earlier-than","later-than","earlier-than-or-equal","later-than-or-equal"]}return MvcGridExtends(t,n),t}(MvcGridFilter),MvcGridEnumFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals"]}return MvcGridExtends(t,n),t}(MvcGridFilter),MvcGridGuidFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals"];this.cssClasses="mvc-grid-guid-filter"}return MvcGridExtends(t,n),t.prototype.isValid=function(n){return!n||/^[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}$/i.test(n)},t}(MvcGridFilter),MvcGridBooleanFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals"]}return MvcGridExtends(t,n),t}(MvcGridFilter);